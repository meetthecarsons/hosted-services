version: "3.8"

services:
  # Tailscale is managed at the host level; do not run another daemon here.

  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID=${PUID:-1000} # user ID (override in .env)
      - PGID=${PGID:-1000} # group ID
      - TZ=${TZ:-America/Los_Angeles}
    volumes:
      - ${JELLYFIN_CONFIG:-/mnt/fast-pool-01/appdata/jellyfin/config}:/config
      - ${JELLYFIN_CACHE:-/mnt/fast-pool-01/appdata/jellyfin/cache}:/cache
      - ${JELLYFIN_MEDIA:-/mnt/bulk-pool-01/data/media}:/data
    devices:
      - /dev/dri:/dev/dri # Pass the Intel GPU device
    group_add:
      - "44" # Add the 'video' group (or the group owning /dev/dri/renderD128)
    networks:
      - internal
    ports:
      - "${JELLYFIN_PORT:-8096}:8096"  # allow direct LAN clients to reach Jellyfin
    restart: unless-stopped


networks:
  internal:
    external: true
